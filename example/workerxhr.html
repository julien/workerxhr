<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title></title>
  <style>
    * { 
      -webkit-box-sizing: border-box;
         -moz-box-sizing: border-box;
              box-sizing: border-box;
    }
  </style>
</head>
<body>
  <script src="../workerxhr.js"></script>
  <script>
    window.onload = function () {
      'use strict';
      var users, userList, index;
        
      userList = document.getElementById('user-list');
      if (!userList) {
        userList = document.createElement('ul');
        userList.id = 'user-list';
        document.body.appendChild(document.createDocumentFragment().appendChild(userList));
      }
      

      function printUsers() {
        var li, user;
        if (index < users.length - 1) {
          index += 1;
          requestAnimationFrame(printUsers);

          user = users[index];
          li = document.createElement('li');
          li.innerHTML = user.email;
          userList.appendChild(document.createDocumentFragment().appendChild(li));

          window.scrollTo(0, userList.offsetHeight);

        } else {
          cancelAnimationFrame(printUsers);
        }
      }

      workerxhr.on('data', function (data) {
        users = data;
        index = -1;
        printUsers();
      });

      workerxhr.load({url: 'workerxhr_data.json'});
    };
  </script>
</body>
</html>

